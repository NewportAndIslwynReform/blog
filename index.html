<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="icon" href="https://pro-worker.reformparty.uk/images/favicon.ico" type="image/x-icon" />
  <link href="https://fonts.googleapis.com/css2?family=Anton&display=swap" rel="stylesheet" />
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Newport & Islwyn Branch Reform UK</title>
  <!-- Load Supabase client library -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js/dist/umd/supabase.min.js"></script>
  <style>
    /* Basic Reset & Layout */
    body {
      margin: 0;
      padding: 20px;
      background-color: #f9f9f9;
    }
    /* Set all text (except title) to Gotham Black */
    body, .container, p, li, input, textarea, button, div, span, a, h2, h3, .entry, .tabs li, .title-links {
      font-family: 'Gotham Black', sans-serif;
    }
    .container {
      width: 100%;
      max-width: 1000px;
      margin: 50px auto;
      background: #00bed6; /* Changed background color */
      padding: 20px;
      border-radius: 4px;
      box-shadow: 2px 2px 10px rgba(0,0,0,0.1);
      position: relative;
    }
    /* Title Block with inline logo, title, and links */
    .title-block {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 10px;
      background-color: white; /* Title block background changed to white */
      padding: 10px;
    }
    .title-left {
      display: flex;
      align-items: center;
    }
    #logo {
      display: inline-block;
      vertical-align: middle;
      width: 80px;
      height: auto;
      margin-right: 10px;
    }
    .title-block h1 {
      margin: 0;
      font-size: 2rem;
      color: #333;
      font-family: 'Anton', sans-serif; /* Title font remains Anton */
      display: inline-block;
    }
    .title-links a {
      font-size: 0.9rem;
      text-decoration: none;
      color: #333;
      margin-left: 10px;
    }
    .title-links a:hover {
      text-decoration: underline;
    }
    /* Hamburger Menu Icon */
    #menuIcon {
      font-size: 2rem;
      cursor: pointer;
      margin: 20px 0 10px 10px; /* Moved down further so it doesn't cover the logo */
      display: inline-block;
    }
    /* Hide tabs by default */
    .tabs {
      display: none;
      list-style: none;
      padding: 0;
      margin: 0;
    }
    /* When menu is active, show tabs as a vertical menu */
    .menu-active .tabs {
      display: block;
      position: absolute;
      top: 120px; /* Moved down so it does not cover the logo */
      left: 10px;
      width: 200px;
      background: #fff;
      border: 1px solid #333;
      z-index: 100;
    }
    /* Ensure admin-only menu items remain hidden if not in admin mode */
    .menu-active .tabs li.admin-tab {
      display: none;
    }
    .menu-active .tabs li {
      display: block;
      margin: 0;
      border: none;
      padding: 10px;
      text-align: left;
      cursor: pointer;
      background: #f1f1f1;
      border-bottom: 1px solid #ccc;
    }
    .menu-active .tabs li:hover {
      background: #e2e2e2;
    }
    .admin-tab {
      display: none;
    }
    /* Tab Content */
    .tab-content {
      display: none;
      border: 2px solid #333;
      border-top: none;
      padding: 20px;
      background: #fff;
    }
    .tab-content.active {
      display: block;
    }
    /* Form Styles */
    form input[type="text"],
    form input[type="date"],
    form textarea {
      width: 100%;
      padding: 8px;
      margin: 5px 0;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
    }
    form button {
      padding: 10px 20px;
      background: #007BFF;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin-top: 5px;
    }
    form button:hover {
      background: #0056b3;
    }
    /* Items / Posts */
    .post, .item {
      border: 1px solid #ddd;
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 4px;
      background: #fafafa;
    }
    .post h2, .item h3 {
      margin: 5px 0;
    }
    /* Collapsible Entry (Blog, News, Minutes) */
    .entry .entry-header {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      cursor: pointer;
    }
    .entry-header .toggle-arrow {
      display: inline-block;
      width: 1.2em;
      font-size: 1.2em;
      margin-bottom: 5px;
    }
    .entry-header p {
      margin: 0;
      font-size: 0.9em;
      color: #666;
    }
    .entry-content {
      display: none;
      margin-top: 10px;
    }
    /* Controls (Edit/Delete) */
    .controls {
      margin-top: 10px;
    }
    .controls button {
      margin-right: 5px;
      padding: 5px 10px;
      font-size: 0.9em;
    }
    /* Committee Member Image Sizing */
    .committee-img {
      width: 80px;
      height: 80px;
      max-width: 80px;
      max-height: 80px;
      border-radius: 50%;
      object-fit: cover;
      margin-right: 15px;
    }
    /* Drop Zone */
    .drop-zone {
      border: 2px dashed #ccc;
      padding: 10px;
      text-align: center;
      margin: 5px 0;
    }
    .drop-zone--over {
      border-color: #007BFF;
    }
    /* Modal Login & About */
    .modal {
      display: none;
      position: fixed;
      z-index: 120;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.4);
    }
    .modal-content {
      background: #fff;
      margin: 15% auto;
      padding: 20px;
      border: 1px solid #888;
      width: 300px;
      border-radius: 4px;
      text-align: center;
      position: relative;
    }
    .close {
      color: #aaa;
      position: absolute;
      top: 5px;
      right: 10px;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
    }
    .close:hover,
    .close:focus {
      color: black;
    }
    /* Admin-only sections */
    .admin-only {
      display: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Title Block with Logo on Left and Admin/About Links on Right -->
    <div class="title-block">
      <div class="title-left">
        <img id="logo" src="https://assets.nationbuilder.com/reformuk/sites/10/meta_images/original/PROFILEPIC600.jpg?1720530274" alt="Logo">
        <h1>NEWPORT & ISLWYN BRANCH</h1>
      </div>
      <div class="title-links">
        <a href="#" id="adminLink">Admin</a>
        <a href="#" id="aboutLink">About</a>
      </div>
    </div>

    <!-- Hamburger Menu Icon -->
    <div id="menuIcon">&#9776;</div>

    <!-- Tab Navigation (vertical menu, hidden by default) -->
    <ul class="tabs">
      <li data-tab="homeTab">Home</li>
      <li data-tab="news">News</li>
      <li data-tab="blog">Blog</li>
      <li data-tab="events">Events</li>
      <li data-tab="committee">Committee</li>
      <li data-tab="links">Links</li>
      <li data-tab="minutes">Minutes</li>
      <li data-tab="entry" class="admin-tab">Add Entries</li>
      <li data-tab="addCommittee" class="admin-tab">Add Committee</li>
    </ul>

    <!-- Tab Content Sections -->
    <div id="homeTab" class="tab-content active">
      <div id="homeDisplay">Loading...</div>
    </div>
    
    <!-- News Tab Content (public view) -->
    <div id="news" class="tab-content">
      <h2>News</h2>
      <div id="newsList">Loading...</div>
    </div>

    <div id="blog" class="tab-content">
      <h2>Blog</h2>
      <div id="blogPosts">Loading...</div>
    </div>

    <div id="events" class="tab-content">
      <h2>Events</h2>
      <div id="eventList">Loading...</div>
    </div>

    <div id="committee" class="tab-content">
      <h2>Committee</h2>
      <div id="committeeList">Loading...</div>
    </div>

    <div id="links" class="tab-content">
      <h2>Links</h2>
      <div id="linksList">Loading...</div>
      <div id="linkFormContainer" class="admin-only">
        <h3>Add New Link</h3>
        <form id="linkForm">
          <input type="text" id="linkName" placeholder="Link Name" required>
          <input type="text" id="linkURL" placeholder="Link URL" required>
          <button type="submit">Add Link</button>
        </form>
      </div>
    </div>

    <div id="minutes" class="tab-content">
      <h2>Minutes</h2>
      <div id="minutesList">Loading...</div>
      <div id="minutesFormContainer" class="admin-only">
        <h3>Add New Meeting Minutes</h3>
        <form id="minutesForm">
          <input type="date" id="minutesDate" placeholder="Date" required>
          <input type="text" id="minutesTitle" placeholder="Title" required>
          <textarea id="minutesContent" placeholder="Enter minutes here..." rows="4" required></textarea>
          <button type="submit">Add Minutes</button>
        </form>
      </div>
    </div>

    <!-- Add Entries Tab (Admin Only) -->
    <div id="entry" class="tab-content admin-tab">
      <h2>Add New Entries</h2>
      <div class="entry-section">
        <h3>New Blog Post</h3>
        <form id="blogForm">
          <input type="date" id="blogDate" placeholder="Date" required>
          <input type="text" id="blogTitle" placeholder="Title" required>
          <textarea id="blogContent" placeholder="Enter blog content here..." rows="4" required></textarea>
          <button type="submit">Add Blog Post</button>
        </form>
      </div>
      <div class="entry-section">
        <h3>New Event</h3>
        <form id="eventForm">
          <input type="text" id="eventTitle" placeholder="Event Title" required>
          <input type="date" id="eventDate" required>
          <textarea id="eventDescription" placeholder="Event Description" rows="4" required></textarea>
          <button type="submit">Add Event</button>
        </form>
      </div>
      <div class="entry-section">
        <h3>New News Item</h3>
        <form id="newsForm">
          <input type="date" id="newsDate" placeholder="News Date" required>
          <input type="text" id="newsTitle" placeholder="News Title" required>
          <textarea id="newsText" placeholder="News Text" rows="4" required></textarea>
          <!-- Drop zone for news image -->
          <div id="newsDropZone" class="drop-zone">
            <img id="newsPreview" class="committee-img" src="https://placehold.co/80" alt="Drop image here">
            <p>Drag & drop an image here</p>
          </div>
          <button type="submit">Add News Item</button>
        </form>
        <h3>Manage News Items</h3>
        <div id="newsEntries">Loading...</div>
      </div>
    </div>

    <div id="addCommittee" class="tab-content admin-tab">
      <h2>Add Committee Member</h2>
      <form id="committeeForm">
        <input type="text" id="committeeName" placeholder="Member Name" required>
        <input type="text" id="committeePosition" placeholder="Position" required>
        <input type="text" id="committeeContact" placeholder="Contact" required>
        <div id="committeeDropZone" class="drop-zone">
          <img id="committeePreview" class="committee-img" src="https://placehold.co/80" alt="Drop image here">
          <p>Drag & drop an image here</p>
        </div>
        <button type="submit">Add Committee Member</button>
      </form>
    </div>
  </div>

  <!-- Modal Login Window -->
  <div id="loginModal" class="modal">
    <div class="modal-content">
      <span class="close" id="modalClose">&times;</span>
      <h2>Admin Login</h2>
      <input type="password" id="adminPassword" placeholder="Enter password" style="width:100%; padding:8px; margin-bottom:10px; border:1px solid #ccc; border-radius:4px;">
      <button id="loginButton">Login</button>
    </div>
  </div>

  <!-- Modal About Window -->
  <div id="aboutModal" class="modal">
    <div class="modal-content">
      <span class="close" id="aboutModalClose">&times;</span>
      <h2>About</h2>
      <div id="aboutContent">Loading...</div>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", function() {
      // Helper: Format dates to UK format (DD/MM/YYYY)
      function formatDate(dateString) {
        const date = new Date(dateString);
        const day = String(date.getDate()).padStart(2, '0');
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const year = date.getFullYear();
        return `${day}/${month}/${year}`;
      }

      // Initialize Supabase
      const supabaseUrl = "https://hvpyeaouttceulkcowhr.supabase.co";
      const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh2cHllYW91dHRjZXVsa2Nvd2hyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzkxMDE1NDIsImV4cCI6MjA1NDY3NzU0Mn0.rO5Q6lIcEjpmvpTy1yD2nqJi_wmuSVhl1Ojf0qOEgIU";
      const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);

      // Global data and admin mode flag
      let homeData = {};
      let blogPostsData = [];
      let newsData = [];
      let eventsData = [];
      let committeeMembersData = [];
      let linksData = [];
      let meetingMinutesData = [];
      let adminMode = false;

      // Fetch functions
      async function fetchHome() {
        const { data, error } = await supabaseClient
          .from("home")
          .select("*")
          .limit(1);
        if (error) {
          document.getElementById("homeTab").innerText = "Error: " + error.message;
          console.error("Error fetching home data:", error);
        } else if (data.length > 0) {
          homeData = data[0];
          renderHome();
        }
      }
      async function fetchBlogPosts() {
        const { data, error } = await supabaseClient
          .from("blog_posts")
          .select("*")
          .order("date", { ascending: false });
        if (error) {
          document.getElementById("blogPosts").innerText = "Error: " + error.message;
          console.error("Error fetching blog posts:", error);
        } else {
          blogPostsData = data;
          renderBlogPosts();
        }
      }
      async function fetchNews() {
        const { data, error } = await supabaseClient
          .from("news")
          .select("*")
          .order("news_date", { ascending: false });
        if (error) {
          document.getElementById("newsList").innerText = "Error: " + error.message;
          console.error("Error fetching news:", error);
        } else {
          newsData = data;
          renderNews();
          if(document.getElementById("newsEntries")){
            renderNewsEntries();
          }
        }
      }
      async function fetchEvents() {
        const { data, error } = await supabaseClient
          .from("events")
          .select("*")
          .order("date", { ascending: false });
        if (error) {
          document.getElementById("eventList").innerText = "Error: " + error.message;
          console.error("Error fetching events:", error);
        } else {
          eventsData = data;
          renderEvents();
        }
      }
      async function fetchCommitteeMembers() {
        const { data, error } = await supabaseClient
          .from("committee_members")
          .select("*")
          .order("id", { ascending: false });
        if (error) {
          document.getElementById("committeeList").innerText = "Error: " + error.message;
          console.error("Error fetching committee members:", error);
        } else {
          committeeMembersData = data;
          renderCommitteeMembers();
        }
      }
      async function fetchLinks() {
        const { data, error } = await supabaseClient
          .from("links")
          .select("*")
          .order("id", { ascending: false });
        if (error) {
          document.getElementById("linksList").innerText = "Error: " + error.message;
          console.error("Error fetching links:", error);
        } else {
          linksData = data;
          renderLinks();
        }
      }
      async function fetchMeetingMinutes() {
        const { data, error } = await supabaseClient
          .from("minutes")
          .select("*")
          .order("date", { ascending: false });
        if (error) {
          document.getElementById("minutesList").innerText = "Error: " + error.message;
          console.error("Error fetching meeting minutes:", error);
        } else {
          meetingMinutesData = data;
          renderMeetingMinutes();
        }
      }

      // New: News Add/Edit/Delete Functions
      async function addNewsItem(date, title, text, image) {
        const { error } = await supabaseClient
          .from("news")
          .insert([{ news_date: date, news_title: title, news_text: text, news_image: image }]);
        if (error) {
          alert("Error adding news item: " + error.message);
          console.error("Error adding news item:", error);
        } else {
          fetchNews();
        }
      }

      function renderNewsEntries() {
        const container = document.getElementById("newsEntries");
        if (!newsData || newsData.length === 0) {
          container.innerText = "No news items found.";
          return;
        }
        let html = "";
        newsData.forEach(item => {
          html += `<div class="post" data-id="${item.id}">
                     <div class="entry">
                       <div class="entry-header">
                         <span class="toggle-arrow" onclick="toggleNewsEntry(${item.id}, event)">►</span>
                         <p><em>${formatDate(item.news_date)}</em></p>
                         <h2>${item.news_title}</h2>
                       </div>
                       <div id="news-content-${item.id}" class="entry-content" style="display:none;">
                         <div style="text-align:center;">
                           <img src="${item.news_image}" alt="News Image" style="max-width:30%; height:auto;">
                         </div>
                         <p>${item.news_text}</p>
                       </div>
                     </div>
                     <div class="controls">
                       <button onclick="startEditNews(${item.id})">Edit</button>
                       <button onclick="deleteNewsItem(${item.id})">Delete</button>
                     </div>
                   </div>`;
        });
        container.innerHTML = html;
      }

      function startEditNews(newsId) {
        const item = newsData.find(n => n.id == newsId);
        if (!item) return;
        const newsDiv = document.querySelector(`#newsEntries .post[data-id="${newsId}"]`);
        newsDiv.innerHTML = `<form class="edit-form" onsubmit="submitEditNews(event, ${newsId})">
                               <input type="date" id="editNewsDate_${newsId}" value="${item.news_date}" required>
                               <input type="text" id="editNewsTitle_${newsId}" value="${item.news_title}" required>
                               <textarea id="editNewsText_${newsId}" rows="4" required>${item.news_text}</textarea>
                               <div id="newsEditDropZone_${newsId}" class="drop-zone">
                                 <img id="newsEditPreview_${newsId}" class="committee-img" src="${item.news_image}" alt="Drop image here">
                                 <p>Drag & drop an image here</p>
                               </div>
                               <button type="submit">Save</button>
                               <button type="button" onclick="cancelEditNews(${newsId})">Cancel</button>
                             </form>`;
        const newsEditDropZone = document.getElementById("newsEditDropZone_" + newsId);
        const newsEditPreview = document.getElementById("newsEditPreview_" + newsId);
        newsEditDropZone.addEventListener("dragover", function(e) {
          e.preventDefault();
          newsEditDropZone.classList.add("drop-zone--over");
        });
        newsEditDropZone.addEventListener("dragleave", function(e) {
          e.preventDefault();
          newsEditDropZone.classList.remove("drop-zone--over");
        });
        newsEditDropZone.addEventListener("drop", function(e) {
          e.preventDefault();
          newsEditDropZone.classList.remove("drop-zone--over");
          const files = e.dataTransfer.files;
          if (files.length > 0) {
            const file = files[0];
            if (file.type.startsWith("image/")) {
              const reader = new FileReader();
              reader.onload = function(e) {
                newsEditPreview.src = e.target.result;
              };
              reader.readAsDataURL(file);
            } else {
              alert("Please drop an image file.");
            }
          }
        });
      }
      async function submitEditNews(e, newsId) {
        e.preventDefault();
        const newDate = document.getElementById(`editNewsDate_${newsId}`).value;
        const newTitle = document.getElementById(`editNewsTitle_${newsId}`).value;
        const newText = document.getElementById(`editNewsText_${newsId}`).value;
        const newImage = document.getElementById(`newsEditPreview_${newsId}`).src;
        console.log("submitEditNews called for news", newsId, newDate, newTitle, newText, newImage);
        const { error } = await supabaseClient
          .from("news")
          .update({ news_date: newDate, news_title: newTitle, news_text: newText, news_image: newImage })
          .eq("id", Number(newsId));
        if (error) {
          alert("Error updating news item: " + error.message);
          console.error("Error updating news item:", error);
        } else {
          fetchNews();
        }
      }
      function cancelEditNews(newsId) {
        renderNewsEntries();
      }
      async function deleteNewsItem(newsId) {
        const { error } = await supabaseClient
          .from("news")
          .delete()
          .eq("id", newsId);
        if (error) {
          alert("Error deleting news item: " + error.message);
          console.error("Error deleting news item:", error);
        } else {
          fetchNews();
        }
      }

      // Rendering functions for other sections
      function renderHome() {
        const container = document.getElementById("homeTab");
        if (!homeData || !homeData.title) {
          container.innerText = "No home data found.";
          return;
        }
        let html = `<div id="homeDisplay">
                      <h2>${homeData.title}</h2>
                      <p>${homeData.content}</p>
                    </div>`;
        if (adminMode) {
          html += `<div class="controls">
                     <button onclick="startEditHome()">Edit</button>
                   </div>`;
        }
        container.innerHTML = html;
      }
      function renderBlogPosts() {
        const container = document.getElementById("blogPosts");
        if (!blogPostsData || blogPostsData.length === 0) {
          container.innerText = "No blog posts found.";
          return;
        }
        let html = "";
        blogPostsData.forEach(post => {
          html += `<div class="post" data-id="${post.id}">
                     <div class="entry">
                       <div class="entry-header">
                         <span class="toggle-arrow" onclick="toggleBlogEntry(${post.id}, event)">►</span>
                         <p><em>${formatDate(post.date)}</em></p>
                         <h2>${post.title}</h2>
                       </div>
                       <div id="blog-content-${post.id}" class="entry-content" style="display:none;">
                         <p>${post.content}</p>
                       </div>
                     </div>`;
          if (adminMode) {
            html += `<div class="controls">
                       <button onclick="startEdit(${post.id})">Edit</button>
                       <button onclick="deleteBlogPost(${post.id})">Delete</button>
                     </div>`;
          }
          html += `</div>`;
        });
        container.innerHTML = html;
      }
      function renderNews() {
        const container = document.getElementById("newsList");
        if (!newsData || newsData.length === 0) {
          container.innerText = "No news found.";
          return;
        }
        let html = "";
        newsData.forEach(item => {
          html += `<div class="post" data-id="${item.id}">
                     <div class="entry">
                       <div class="entry-header">
                         <span class="toggle-arrow" onclick="toggleNewsEntry(${item.id}, event)">►</span>
                         <p><em>${formatDate(item.news_date)}</em></p>
                         <h2>${item.news_title}</h2>
                       </div>
                       <div id="news-content-${item.id}" class="entry-content" style="display:none;">
                         <div style="text-align:center;">
                           <img src="${item.news_image}" alt="News Image" style="max-width:30%; height:auto;">
                         </div>
                         <p>${item.news_text}</p>
                       </div>
                     </div>
                   </div>`;
        });
        container.innerHTML = html;
      }
      function renderEvents() {
        const container = document.getElementById("eventList");
        if (!eventsData || eventsData.length === 0) {
          container.innerText = "No events found.";
          return;
        }
        let html = "";
        eventsData.forEach(event => {
          html += `<div class="post" data-id="${event.id}">
                     <p><strong>${formatDate(event.date)}</strong></p>
                     <h2>${event.title}</h2>
                     <p>${event.description}</p>`;
          if (adminMode) {
            html += `<div class="controls">
                       <button onclick="startEditEvent(${event.id})">Edit</button>
                       <button onclick="deleteEvent(${event.id})">Delete</button>
                     </div>`;
          }
          html += `</div>`;
        });
        container.innerHTML = html;
      }
      function renderCommitteeMembers() {
        const container = document.getElementById("committeeList");
        if (!committeeMembersData || committeeMembersData.length === 0) {
          container.innerText = "No committee members found.";
          return;
        }
        let html = "";
        committeeMembersData.forEach(member => {
          html += `<div class="post" data-id="${member.id}">
                     <h3>${member.name}</h3>
                     <p><strong>Position:</strong> ${member.position}</p>
                     <p><strong>Contact:</strong> ${member.contact}</p>`;
          if (member.image_url) {
            html += `<img src="${member.image_url}" alt="${member.name}" class="committee-img">`;
          }
          if (adminMode) {
            html += `<div class="controls">
                       <button onclick="startEditCommittee(${member.id})">Edit</button>
                       <button onclick="deleteCommitteeMember(${member.id})">Delete</button>
                     </div>`;
          }
          html += `</div>`;
        });
        container.innerHTML = html;
      }
      function renderLinks() {
        const container = document.getElementById("linksList");
        if (!linksData || linksData.length === 0) {
          container.innerText = "No links found.";
          return;
        }
        let html = "";
        linksData.forEach(link => {
          let anchorStyle = adminMode ? 'style="pointer-events: none;"' : "";
          html += `<div class="post" data-id="${link.id}">
                     <h3><a href="${link.url}" target="_blank" ${anchorStyle}>${link.name}</a></h3>`;
          if (adminMode) {
            html += `<div class="controls">
                       <button onclick="startEditLink('${link.id}')">Edit</button>
                       <button onclick="deleteLink('${link.id}')">Delete</button>
                     </div>`;
          }
          html += `</div>`;
        });
        container.innerHTML = html;
      }
      function renderMeetingMinutes() {
        const container = document.getElementById("minutesList");
        if (!meetingMinutesData || meetingMinutesData.length === 0) {
          container.innerText = "No meeting minutes found.";
          return;
        }
        let html = "";
        meetingMinutesData.forEach(record => {
          html += `<div class="post" data-id="${record.id}">
                     <div class="entry">
                       <div class="entry-header">
                         <span class="toggle-arrow" onclick="toggleMinutes(${record.id}, event)">►</span>
                         <p><em>${formatDate(record.date)}</em></p>
                         <h2>${record.title}</h2>
                       </div>
                       <div id="minutes-content-${record.id}" class="entry-content" style="display:none;">
                         <p>${record.minutes}</p>
                       </div>
                     </div>`;
          if (adminMode) {
            html += `<div class="controls">
                       <button onclick="startEditMinutes(${record.id})">Edit</button>
                       <button onclick="deleteMinutes(${record.id})">Delete</button>
                     </div>`;
          }
          html += `</div>`;
        });
        container.innerHTML = html;
      }

      /***** Inline Editing Functions *****/
      // Blog editing
      function startEdit(postId) {
        const post = blogPostsData.find(p => p.id == postId);
        if (!post) return;
        const postDiv = document.querySelector(`.post[data-id="${postId}"]`);
        postDiv.innerHTML = `<form class="edit-form" onsubmit="submitEdit(event, ${postId})">
                               <input type="date" id="editDate_${postId}" value="${post.date}" required>
                               <input type="text" id="editTitle_${postId}" value="${post.title}" required>
                               <textarea id="editContent_${postId}" rows="10" style="overflow-y: auto; height:200px;" required>${post.content}</textarea>
                               <button type="submit">Save</button>
                               <button type="button" onclick="cancelEdit(${postId})">Cancel</button>
                             </form>`;
      }
      async function submitEdit(e, postId) {
        e.preventDefault();
        const newDate = document.getElementById(`editDate_${postId}`).value;
        const newTitle = document.getElementById(`editTitle_${postId}`).value;
        const newContent = document.getElementById(`editContent_${postId}`).value;
        console.log("submitEdit called for post", postId, newDate, newTitle, newContent);
        const { error } = await supabaseClient
          .from("blog_posts")
          .update({ date: newDate, title: newTitle, content: newContent })
          .eq("id", Number(postId));
        if (error) {
          alert("Error updating post: " + error.message);
          console.error("Error updating post:", error);
        } else {
          fetchBlogPosts();
        }
      }
      function cancelEdit(postId) {
        renderBlogPosts();
      }
      // Event editing
      function startEditEvent(eventId) {
        const eventData = eventsData.find(e => e.id == eventId);
        if (!eventData) return;
        const eventDiv = document.querySelector(`.post[data-id="${eventId}"]`);
        eventDiv.innerHTML = `<form class="edit-form" onsubmit="submitEditEvent(event, ${eventId})">
                               <input type="text" id="editEventTitle_${eventId}" value="${eventData.title}" required>
                               <input type="date" id="editEventDate_${eventId}" value="${eventData.date}" required>
                               <textarea id="editEventDescription_${eventId}" rows="4" required>${eventData.description}</textarea>
                               <button type="submit">Save</button>
                               <button type="button" onclick="cancelEditEvent(${eventId})">Cancel</button>
                             </form>`;
      }
      async function submitEditEvent(e, eventId) {
        e.preventDefault();
        const newTitle = document.getElementById(`editEventTitle_${eventId}`).value;
        const newDate = document.getElementById(`editEventDate_${eventId}`).value;
        const newDescription = document.getElementById(`editEventDescription_${eventId}`).value;
        console.log("submitEditEvent called for event", eventId, newTitle, newDate, newDescription);
        const { error } = await supabaseClient
          .from("events")
          .update({ title: newTitle, date: newDate, description: newDescription })
          .eq("id", Number(eventId));
        if (error) {
          alert("Error updating event: " + error.message);
          console.error("Error updating event:", error);
        } else {
          fetchEvents();
        }
      }
      function cancelEditEvent(eventId) {
        renderEvents();
      }
      // Committee editing
      function startEditCommittee(memberId) {
        const member = committeeMembersData.find(m => m.id == memberId);
        if (!member) return;
        const memberDiv = document.querySelector(`.post[data-id="${memberId}"]`);
        memberDiv.innerHTML = `<form class="edit-form" onsubmit="submitEditCommittee(event, ${memberId})">
                               <input type="text" id="editCommitteeName_${memberId}" value="${member.name}" required>
                               <input type="text" id="editCommitteePosition_${memberId}" value="${member.position}" required>
                               <input type="text" id="editCommitteeContact_${memberId}" value="${member.contact}" required>
                               <input type="text" id="editCommitteeImageUrl_${memberId}" value="${member.image_url}" required>
                               <button type="submit">Save</button>
                               <button type="button" onclick="cancelEditCommittee(${memberId})">Cancel</button>
                             </form>`;
      }
      async function submitEditCommittee(e, memberId) {
        e.preventDefault();
        const newName = document.getElementById(`editCommitteeName_${memberId}`).value;
        const newPosition = document.getElementById(`editCommitteePosition_${memberId}`).value;
        const newContact = document.getElementById(`editCommitteeContact_${memberId}`).value;
        const newImageUrl = document.getElementById(`editCommitteeImageUrl_${memberId}`).value;
        console.log("submitEditCommittee called for member", memberId, newName, newPosition, newContact, newImageUrl);
        const { error } = await supabaseClient
          .from("committee_members")
          .update({ name: newName, position: newPosition, contact: newContact, image_url: newImageUrl })
          .eq("id", Number(memberId));
        if (error) {
          alert("Error updating committee member: " + error.message);
          console.error("Error updating committee member:", error);
        } else {
          fetchCommitteeMembers();
        }
      }
      function cancelEditCommittee(memberId) {
        renderCommitteeMembers();
      }
      // Link inline editing
      function startEditLink(linkId) {
        const link = linksData.find(l => l.id == linkId);
        if (!link) return;
        const linkDiv = document.querySelector(`.post[data-id='${linkId}']`);
        linkDiv.innerHTML = `<form class="edit-form" onsubmit="submitEditLink(event, '${linkId}')">
                               <input type="text" id="editLinkName_${linkId}" value="${link.name}" required>
                               <input type="text" id="editLinkURL_${linkId}" value="${link.url}" required>
                               <button type="submit">Save</button>
                               <button type="button" onclick="cancelEditLink('${linkId}')">Cancel</button>
                             </form>`;
      }
      async function submitEditLink(e, linkId) {
        e.preventDefault();
        const newName = document.getElementById(`editLinkName_${linkId}`).value;
        const newURL = document.getElementById(`editLinkURL_${linkId}`).value;
        console.log("submitEditLink called for link", linkId, newName, newURL);
        const { error } = await supabaseClient
          .from("links")
          .update({ name: newName, url: newURL })
          .eq("id", linkId);
        if (error) {
          alert("Error updating link: " + error.message);
          console.error("Error updating link:", error);
        } else {
          fetchLinks();
        }
      }
      function cancelEditLink(linkId) {
        renderLinks();
      }
      // Toggle functions for collapsible content
      function toggleBlogEntry(postId, event) {
        event.stopPropagation();
        const contentElement = document.getElementById("blog-content-" + postId);
        const arrow = event.target;
        const currentDisplay = window.getComputedStyle(contentElement).display;
        if (currentDisplay === "none") {
          contentElement.style.display = "block";
          arrow.textContent = "▼";
        } else {
          contentElement.style.display = "none";
          arrow.textContent = "►";
        }
      }
      function toggleNewsEntry(newsId, event) {
        event.stopPropagation();
        const contentElement = document.getElementById("news-content-" + newsId);
        const arrow = event.target;
        const currentDisplay = window.getComputedStyle(contentElement).display;
        if (currentDisplay === "none") {
          contentElement.style.display = "block";
          arrow.textContent = "▼";
        } else {
          contentElement.style.display = "none";
          arrow.textContent = "►";
        }
      }
      function toggleMinutes(recordId, event) {
        event.stopPropagation();
        const contentElement = document.getElementById("minutes-content-" + recordId);
        const arrow = event.target;
        if (contentElement.style.display === "none" || contentElement.style.display === "") {
          contentElement.style.display = "block";
          arrow.textContent = "▼";
        } else {
          contentElement.style.display = "none";
          arrow.textContent = "►";
        }
      }
      // Meeting Minutes inline editing
      function startEditMinutes(id) {
        const record = meetingMinutesData.find(r => r.id == id);
        if (!record) return;
        const div = document.querySelector(`.post[data-id="${id}"]`);
        div.innerHTML = `<form class="edit-form" onsubmit="submitEditMinutes(event, ${id})">
                          <input type="date" id="editMinutesDate_${id}" value="${record.date}" required>
                          <input type="text" id="editMinutesTitle_${id}" value="${record.title}" required>
                          <textarea id="editMinutesContent_${id}" rows="4" required>${record.minutes}</textarea>
                          <button type="submit">Save</button>
                          <button type="button" onclick="cancelEditMinutes(${id})">Cancel</button>
                        </form>`;
      }
      async function submitEditMinutes(e, id) {
        e.preventDefault();
        const newDate = document.getElementById("editMinutesDate_" + id).value;
        const newTitle = document.getElementById("editMinutesTitle_" + id).value;
        const newContent = document.getElementById("editMinutesContent_" + id).value;
        console.log("submitEditMinutes called for id", id, newDate, newTitle, newContent);
        const { error } = await supabaseClient
          .from("minutes")
          .update({ date: newDate, title: newTitle, minutes: newContent })
          .eq("id", Number(id));
        if (error) {
          alert("Error updating meeting minutes: " + error.message);
          console.error("Error updating meeting minutes:", error);
        } else {
          fetchMeetingMinutes();
        }
      }
      function cancelEditMinutes(id) {
        renderMeetingMinutes();
      }
      // Home inline editing
      function startEditHome() {
        const container = document.getElementById("homeTab");
        container.innerHTML = `<form class="edit-form" onsubmit="submitEditHome(event)">
                                 <input type="text" id="editHomeTitle" value="${homeData.title}" required>
                                 <textarea id="editHomeContent" rows="6" style="overflow-y: auto; height:150px;" required>${homeData.content}</textarea>
                                 <button type="submit">Save</button>
                                 <button type="button" onclick="cancelEditHome()">Cancel</button>
                               </form>`;
      }
      async function submitEditHome(e) {
        e.preventDefault();
        const newTitle = document.getElementById("editHomeTitle").value;
        const newContent = document.getElementById("editHomeContent").value;
        console.log("submitEditHome called", newTitle, newContent);
        const { error } = await supabaseClient
          .from("home")
          .update({ title: newTitle, content: newContent })
          .eq("id", Number(homeData.id));
        if (error) {
          alert("Error updating home data: " + error.message);
          console.error("Error updating home data:", error);
        } else {
          fetchHome();
        }
      }
      function cancelEditHome() {
        renderHome();
      }

      /***** Form Submission for Adding New Data *****/
      async function addBlogPost(date, title, content) {
        const { error } = await supabaseClient
          .from("blog_posts")
          .insert([{ date, title, content }]);
        if (error) {
          alert("Error adding blog post: " + error.message);
          console.error("Error adding blog post:", error);
        } else {
          fetchBlogPosts();
        }
      }
      async function addEvent(title, date, description) {
        const { error } = await supabaseClient
          .from("events")
          .insert([{ title, date, description }]);
        if (error) {
          alert("Error adding event: " + error.message);
          console.error("Error adding event:", error);
        } else {
          fetchEvents();
        }
      }
      async function addCommitteeMember(name, position, contact, image_url) {
        const { error } = await supabaseClient
          .from("committee_members")
          .insert([{ name, position, contact, image_url }]);
        if (error) {
          alert("Error adding committee member: " + error.message);
          console.error("Error adding committee member:", error);
        } else {
          fetchCommitteeMembers();
        }
      }
      async function addLink(name, url) {
        const { error } = await supabaseClient
          .from("links")
          .insert([{ name, url }]);
        if (error) {
          alert("Error adding link: " + error.message);
          console.error("Error adding link:", error);
        } else {
          fetchLinks();
        }
      }
      async function addMeetingMinutes(date, title, minutesContent) {
        const { error } = await supabaseClient
          .from("minutes")
          .insert([{ date, title, minutes: minutesContent }]);
        if (error) {
          alert("Error adding meeting minutes: " + error.message);
          console.error("Error adding meeting minutes:", error);
        } else {
          fetchMeetingMinutes();
        }
      }

      // Attach form submit listeners
      document.getElementById("blogForm").addEventListener("submit", function(e) {
        e.preventDefault();
        const date = document.getElementById("blogDate").value;
        const title = document.getElementById("blogTitle").value;
        const content = document.getElementById("blogContent").value;
        addBlogPost(date, title, content);
        document.getElementById("blogDate").value = "";
        document.getElementById("blogTitle").value = "";
        document.getElementById("blogContent").value = "";
      });
      document.getElementById("eventForm").addEventListener("submit", function(e) {
        e.preventDefault();
        const title = document.getElementById("eventTitle").value;
        const date = document.getElementById("eventDate").value;
        const description = document.getElementById("eventDescription").value;
        addEvent(title, date, description);
        document.getElementById("eventTitle").value = "";
        document.getElementById("eventDate").value = "";
        document.getElementById("eventDescription").value = "";
      });
      document.getElementById("committeeForm").addEventListener("submit", function(e) {
        e.preventDefault();
        const name = document.getElementById("committeeName").value;
        const position = document.getElementById("committeePosition").value;
        const contact = document.getElementById("committeeContact").value;
        const imageUrl = document.getElementById("committeePreview").src;
        addCommitteeMember(name, position, contact, imageUrl);
        document.getElementById("committeeName").value = "";
        document.getElementById("committeePosition").value = "";
        document.getElementById("committeeContact").value = "";
        document.getElementById("committeePreview").src = "https://placehold.co/80";
      });
      document.getElementById("linkForm").addEventListener("submit", function(e) {
        e.preventDefault();
        const name = document.getElementById("linkName").value;
        const url = document.getElementById("linkURL").value;
        addLink(name, url);
        document.getElementById("linkName").value = "";
        document.getElementById("linkURL").value = "";
      });
      document.getElementById("minutesForm").addEventListener("submit", function(e) {
        e.preventDefault();
        const date = document.getElementById("minutesDate").value;
        const title = document.getElementById("minutesTitle").value;
        const minutesContent = document.getElementById("minutesContent").value;
        addMeetingMinutes(date, title, minutesContent);
        document.getElementById("minutesDate").value = "";
        document.getElementById("minutesTitle").value = "";
        document.getElementById("minutesContent").value = "";
      });
      document.getElementById("newsForm").addEventListener("submit", function(e) {
        e.preventDefault();
        const date = document.getElementById("newsDate").value;
        const title = document.getElementById("newsTitle").value;
        const text = document.getElementById("newsText").value;
        const image = document.getElementById("newsPreview").src;
        addNewsItem(date, title, text, image);
        document.getElementById("newsDate").value = "";
        document.getElementById("newsTitle").value = "";
        document.getElementById("newsText").value = "";
        document.getElementById("newsPreview").src = "https://placehold.co/80";
      });

      // Drag & Drop for Committee Image Upload
      const dropZone = document.getElementById("committeeDropZone");
      const previewImage = document.getElementById("committeePreview");
      dropZone.addEventListener("dragover", function(e) {
        e.preventDefault();
        dropZone.classList.add("drop-zone--over");
      });
      dropZone.addEventListener("dragleave", function(e) {
        e.preventDefault();
        dropZone.classList.remove("drop-zone--over");
      });
      dropZone.addEventListener("drop", function(e) {
        e.preventDefault();
        dropZone.classList.remove("drop-zone--over");
        const files = e.dataTransfer.files;
        if (files.length > 0) {
          const file = files[0];
          if (file.type.startsWith("image/")) {
            const reader = new FileReader();
            reader.onload = function(e) {
              previewImage.src = e.target.result;
            };
            reader.readAsDataURL(file);
          } else {
            alert("Please drop an image file.");
          }
        }
      });

      // Drag & Drop for News Image Upload in Add Entries tab
      const newsDropZone = document.getElementById("newsDropZone");
      const newsPreview = document.getElementById("newsPreview");
      newsDropZone.addEventListener("dragover", function(e) {
        e.preventDefault();
        newsDropZone.classList.add("drop-zone--over");
      });
      newsDropZone.addEventListener("dragleave", function(e) {
        e.preventDefault();
        newsDropZone.classList.remove("drop-zone--over");
      });
      newsDropZone.addEventListener("drop", function(e) {
        e.preventDefault();
        newsDropZone.classList.remove("drop-zone--over");
        const files = e.dataTransfer.files;
        if (files.length > 0) {
          const file = files[0];
          if (file.type.startsWith("image/")) {
            const reader = new FileReader();
            reader.onload = function(e) {
              newsPreview.src = e.target.result;
            };
            reader.readAsDataURL(file);
          } else {
            alert("Please drop an image file.");
          }
        }
      });

      // Tab/Menu Switching Functionality
      const tabs = document.querySelectorAll(".tabs li");
      const tabContents = document.querySelectorAll(".tab-content");
      // When a menu item is clicked, hide the menu
      tabs.forEach(tab => {
        tab.addEventListener("click", () => {
          const target = tab.getAttribute("data-tab");
          tabs.forEach(t => t.classList.remove("active"));
          tabContents.forEach(content => content.classList.remove("active"));
          tab.classList.add("active");
          document.getElementById(target).classList.add("active");
          // Hide the menu after selection
          document.querySelector(".container").classList.remove("menu-active");
        });
      });
      // Toggle menu when hamburger icon is clicked
      document.getElementById("menuIcon").addEventListener("click", function() {
        document.querySelector(".container").classList.toggle("menu-active");
      });

      // Admin Login Functionality
      const adminLink = document.getElementById("adminLink");
      const loginModal = document.getElementById("loginModal");
      const modalClose = document.getElementById("modalClose");
      const loginButton = document.getElementById("loginButton");
      const adminPassword = document.getElementById("adminPassword");
      
      adminLink.addEventListener("click", function(e) {
        e.preventDefault();
        loginModal.style.display = "block";
        adminPassword.value = "";
        adminPassword.focus();
      });
      modalClose.addEventListener("click", function() {
        loginModal.style.display = "none";
      });
      loginButton.addEventListener("click", async function() {
        const { data, error } = await supabaseClient
          .from("password")
          .select("*")
          .limit(1);
        if (error) {
          alert("Error retrieving password: " + error.message);
          console.error("Error retrieving password:", error);
          return;
        }
        if (data.length > 0 && adminPassword.value === data[0].password) {
          document.querySelectorAll(".admin-tab").forEach(el => {
            el.style.display = "";
            el.classList.remove("admin-tab");
          });
          document.querySelectorAll(".admin-only").forEach(el => {
            el.style.display = "block";
          });
          adminMode = true;
          fetchHome();
          fetchBlogPosts();
          fetchNews();
          fetchEvents();
          fetchCommitteeMembers();
          fetchLinks();
          fetchMeetingMinutes();
          loginModal.style.display = "none";
          alert("Admin mode enabled.");
        } else {
          alert("Incorrect password. Please try again.");
        }
      });
      window.addEventListener("click", function(event) {
        if (event.target === loginModal) {
          loginModal.style.display = "none";
        }
      });

      // About Link Functionality
      document.getElementById("aboutLink").addEventListener("click", async function(e) {
        e.preventDefault();
        const { data, error } = await supabaseClient
          .from("password")
          .select("about")
          .limit(1);
        if (error) {
          alert("Error retrieving About content: " + error.message);
          console.error("Error retrieving About content:", error);
          return;
        }
        if (data.length > 0) {
          document.getElementById("aboutContent").innerHTML = data[0].about;
          document.getElementById("aboutModal").style.display = "block";
        } else {
          alert("No About content found.");
        }
      });
      document.getElementById("aboutModalClose").addEventListener("click", function() {
        document.getElementById("aboutModal").style.display = "none";
      });
      window.addEventListener("click", function(event) {
        if (event.target === document.getElementById("aboutModal")) {
          document.getElementById("aboutModal").style.display = "none";
        }
      });

      // New: Toggle function for News entries
      function toggleNewsEntry(newsId, event) {
        event.stopPropagation();
        const contentElement = document.getElementById("news-content-" + newsId);
        const arrow = event.target;
        const currentDisplay = window.getComputedStyle(contentElement).display;
        if (currentDisplay === "none") {
          contentElement.style.display = "block";
          arrow.textContent = "▼";
        } else {
          contentElement.style.display = "none";
          arrow.textContent = "►";
        }
      }

      // On initial page load, fetch all data
      fetchHome();
      fetchBlogPosts();
      fetchNews();
      fetchEvents();
      fetchCommitteeMembers();
      fetchLinks();
      fetchMeetingMinutes();

      // Expose functions to global scope so inline onclicks work
      window.startEdit = startEdit;
      window.submitEdit = submitEdit;
      window.cancelEdit = cancelEdit;
      window.startEditEvent = startEditEvent;
      window.submitEditEvent = submitEditEvent;
      window.cancelEditEvent = cancelEditEvent;
      window.startEditCommittee = startEditCommittee;
      window.submitEditCommittee = submitEditCommittee;
      window.cancelEditCommittee = cancelEditCommittee;
      window.startEditLink = startEditLink;
      window.submitEditLink = submitEditLink;
      window.cancelEditLink = cancelEditLink;
      window.startEditMinutes = startEditMinutes;
      window.submitEditMinutes = submitEditMinutes;
      window.cancelEditMinutes = cancelEditMinutes;
      window.startEditHome = startEditHome;
      window.submitEditHome = submitEditHome;
      window.cancelEditHome = cancelEditHome;
      window.toggleBlogEntry = toggleBlogEntry;
      window.toggleNewsEntry = toggleNewsEntry;
      window.toggleMinutes = toggleMinutes;
      window.startEditNews = startEditNews;
      window.submitEditNews = submitEditNews;
      window.cancelEditNews = cancelEditNews;
      window.deleteNewsItem = deleteNewsItem;
    });
  </script>
</body>
</html>
